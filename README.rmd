---
title: "Macroeconomía II: Tarea 2"
subtitle: "Consumo"
author: equipo 5
date: \today
output: 
  bookdown::pdf_document2:
  toc: true
  toc_depth: 2
  tables: true
  fig_caption: yes
  toc-title: Contenido
  urlcolor: blue
  header-includes:
   - \usepackage[nottoc]{tocbibind}
   - \usepackage[spanish,es-tabla]{babel} 
   - \usepackage[utf8]{inputenc} # Codificación de entrada
   - \usepackage[T1]{fontenc} # Codificación de fuente
   - \usepackage{lmodern} # Fuente compatible
   - \usepackage{graphicx}
   - \usepackage{float}
   - \usepackage{booktabs}
   - \usepackage{longtable}
   - \renewcommand{\listfigurename}{Lista de figuras}
   - \renewcommand{\listtablename}{Lista de tablas}
   - \renewcommand{\spanishfigurename}{Figura}
   - \renewcommand{\spanishtablename}{Tabla}

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
```


```{r carga de librerías}
  pacman::p_load(tidyverse, readr, foreign, msm, lubridate,zoo, janitor, kableExtra, ggplot2, knitr, hexbin, magrittr, readxl, dplyr, broom, tinytext, fOptions, derivmkts)

```




# Ejercicio 1
**Resuelva los ejercicios 8.1, 8.2, 8.4, 8.5 y 8.6,  (Romer, 5a Ed). Realice estos con ayuda de su laboratorista y entregue las soluciones a máquina, utilizando LaTeX.**

## *poner enunciado de Romer*


# Ejercicio 2
*Cree un vector de 20 ingresos permanentes aleatorios $Y_i^P$, distribuidos normalmente, con media 10 y varianza $\sigma^P$. Cree 20 vectores (cada uno de estos vectores representa una persona) cada uno con 100 observaciones idénticas del ingreso permanente. Grafíquelos (eje x, persona; eje y, ingreso permanente)*


## a) 
*Cree un vector de 20 ingresos permanentes aleatorios $Y_i^P$, distribuidos normalmente, con media 10 y varianza $\sigma^P$. Cree 20 vectores (cada uno de estos vectores representa una persona) cada uno con 100 observaciones idénticas del ingreso permanente. Grafíquelos (eje x, persona; eje y, ingreso permanente).*

``` {r inciso 2a}


```
## b)
*Cree 20 vectores de 100 ingresos transitorios aleatorios $Y_{i,t}^T$, distribuidos normalmente, con media 0 y con varianza $\sigma^T$. Grafíquelos.*
``` {r inciso 2b}


```
## c) 
*Cree 20 vectores de 100 ingresos totales $Y_{i,t}$, sumando el ingreso transitorio y el permanente. Grafíquelos.*
``` {r inciso 2c}


```
## d)
*Cree 20 vectores de 100 errores de medición $\epsilon_{i,t}$, distribuidos normalmente, con media 0 y varianza $\sigma^\epsilon>0$. Grafíquelos.*
``` {r inciso 2d}


```
## e)
*Cree  20 vectores de 100 consumos $C_{i,t}$ cada uno, de acuerdo a la siguiente regla $C_{i,t}=Y_i^P+0.1Y_{i,t}^T+\epsilon_{i,t}$. Grafíquelos.*
``` {r inciso 2e}


```
## f)
*Estime la relación lineal entre ingreso total y consumo $C_{i,t}=\alpha+\beta Y_{i,t}+\epsilon_{i,t}$. Describa el resultado de su estimación y grafíque la relación entre las observaciones del consumo y las del ingreso.*
``` {r inciso 2f}


```
## 
*g) Incremente la varianza del ingreso permanente, y disminuya la varianza del ingreso transitorio y vuelva a estimar y graficar la relación entre el consumo y el ingreso.*
``` {r inciso 2g}


```
## 
*h) Disminuya la varianza del ingreso permanente, y aumente la varianza del ingreso transitorio y vuelva a estimar y graficar la relación entre el consumo y el ingreso.*

``` {r inciso 2h}


```


#Ejercicio 3

# Ejercicio 4
**Estudie el consumo de los individuos en México, siguiendo estos pasos:** 

## a)
**Baje los datos de un año de la ENIGH del sitio del INEGI y establezca el número de hogares y el ingreso y el gasto promedio.**

De la página oficial del INEGI se descargó la base "concentrado_hogar" del año 2012. 
Las variables más relevantes para este ejercicio son las siguientes:

\begin{itemize}
  \item Folioviv, Idenficador de la vivienda.
  \item foliohog, número de hogares adicionales a la vivienda.
  \item ubica\_geo, ubicación geográfica;esta compuesta por la clave de entidad federativa y clave del municipio-
  \item clase\_hog, diferenciación de los tipos de hogares (por ejemplo, unipersonales = 1)
  \item edad\_jefe, edad del jefe del hogar a la fecha de la entrevista.
  \item ing\_cor, ingreso corriente.
  \item gasto\_mon, gasto monetario-
  \item factor\_hog, factor de expansión.
\end{itemize}

En seguida, se muestra el "header" de la base de datos (\ref{tab:head})-

```{r head, warning=FALSE}

hog <- read_csv("~/Documents/GitHub/tarea2_consumo/NCV_concentrado_2012_concil_2010.csv")

hog1 <- hog %>% select(folioviv, foliohog,ubica_geo, clase_hog, edad_jefe, ing_cor, gasto_mon, factor_hog) %>% 
  rename( "Folio Vivienda" = folioviv,
         "Folio Hogar"= foliohog, 
         "Ubicación" = ubica_geo, 
         " Edad Jefe" = edad_jefe , 
         "Gasto" = gasto_mon,
         "Ingreso" = ing_cor,
         "Factor"= factor_hog)

kable(head(hog1), booktabs = T, format = "latex", caption = "ENIGH 2012") %>% kable_styling(position = "center", latex_options = "HOLD_position")

```

```{r}

```



## *Estime una relación entre ingreso y gasto y reporte sus resultados.*

Para estimar la relación gasto-ingreso asumimos un modelo lineal que sigue lo siguiente:

\begin{equation}
Gasto =\beta_{0} + \beta_{1}*Ing+U
\end{equation}


Donde $\beta_{0}$ se refiere a la intersección de la regresión, $\beta_{1}$ al coeficiente de la variable ingreso y $U$ es el error. Los resultados se muestran a continuación (\ref{tab:reg})

```{r reg}


lm(data = hog, gasto_mon ~ ing_cor, weights = factor_hog) %>% tidy() %>% 
  kable(booktabs = T, format = "latex", caption = "Relación Gasto-Ingreso") %>% kable_styling(position = "center", latex_options = "HOLD_position")
                                                                

```

Podemos destacar un coeficiente positivo, es decir una relación directa entre el gasto y el ingreso. Además, según el moedelo, un aumento en un peso de ingreso, genera un aumento de 0.5 pesos.


```{r grafica gasto-ingreso}
#hog %>% ggplot(aes(ing_cor, gasto_mon), weight) +
#  geom_point() +
 # geom_smooth(method='lm', weight= factor_hog) 

hog %>% ggplot(aes(x = ing_cor, y= gasto_mon)) + geom_point()+geom_smooth(method = "lm")+ labs(title = "", x="Ingreso corriente",y='Gasto')

```



## *Estime una relación entre ingreso y gasto pero para hogares unipersonales de edad entre 30 y 40 años de edad de la Ciudad de México.*

Para estimar la relación primero se realiza un filtrado de la base de datos con los criterios requeridos:

\begin{itemize}
  \item 30 < edad < 40
  \item clase\_hog == 1 (clave para hogares unipersonales)
  \item Código de entidad federativa 9. (Esto indica los hogares en CDMX)
  \end{itemize}
El resultado de dicho filtrado nos deja con 6 observaciones. Es importante mencionar que hay que considerar el factor de ajuste.


```{r }
hog$ubi <- substr(hog$ubica_geo,1,2) #Separamos el código de la entidad
hog2 <- hog %>% dplyr::filter( edad_jefe >= 30 & edad_jefe <=40, clase_hog == 1, ubi == "09") %>% select( folioviv, gasto_mon, ing_cor, factor_hog)

kable(hog2,booktabs = T, format = "latex", caption = "Relación Gasto-Ingreso para hogares unipersonales de edad entre 30 y 40 años de edad") %>% kable_styling(position = "center", latex_options = "HOLD_position")
```

De nuevo asumimos un modelo lineal como en la ecuación 1-


```{r }
m1 <- lm( data= hog2, gasto_mon ~ ing_cor, weights = factor_hog)
```


```{r }
lm( data= hog2, gasto_mon ~ ing_cor, weights = factor_hog) %>% broom::tidy() %>% 
kable( booktabs = T, format = "latex", caption = "Hogares unipersonales de entre 30 y 40 años de la Ciudad de México") %>% kable_styling(position = "center", latex_options = "HOLD_position")

```

De nuevo podemos ver una relación directa entre ingreso y gasto. La relación es estadísticamente significativa y vemos que la intersección de la regresión es sustancialmente más baja, a pesar de lo anterior, el intercepto no es significativo. Esto se explica por el rango de edad que tomamos en cuenta.La población con las características requeridas, al incrementar su ingreso en un peso, aumenta su gasto en 90 centavos.

```{r graf2}


ggplot(hog2,aes(x = ing_cor, y= gasto_mon)) + geom_point()+geom_smooth(method = "lm")+ labs(title = "", x="Ingreso corriente",y='Gasto')

```



## *Para todos los hogares unipersonales, estime el valor promedio del ingreso por edad, separando la muestra en grupos de edad de cinco años cada uno y grafíquelo.*

```{r}
hog %>% dplyr::filter(clase_hog == 1) %>% 
  mutate(edad = case_when(edad_jefe >= 12 & edad_jefe <=15  ~ '15',
                          edad_jefe > 15 & edad_jefe <= 20 ~ '20',
                          edad_jefe > 20 & edad_jefe <= 25 ~ '25',
                           edad_jefe > 25 & edad_jefe <= 30 ~ '30',
                           edad_jefe > 30 & edad_jefe <= 35 ~ '35',
                           edad_jefe > 35 & edad_jefe <= 40 ~ '40',
                           edad_jefe > 40 & edad_jefe <= 45 ~ '45',
                           edad_jefe > 45 & edad_jefe <= 50 ~ '50',
                           edad_jefe > 50 & edad_jefe <= 55 ~ '55',
                           edad_jefe > 55 & edad_jefe <= 60 ~ '60',
                           edad_jefe > 60 & edad_jefe <= 65 ~ '65',
                           edad_jefe > 65 & edad_jefe <= 70 ~ '70',
                           edad_jefe > 70 & edad_jefe <= 75 ~ '75',
                           edad_jefe > 75 & edad_jefe <= 80 ~ '80',
                           edad_jefe > 80 & edad_jefe <= 85 ~ '85',
                           edad_jefe > 85 & edad_jefe <= 90 ~ '90',
                           edad_jefe > 90 & edad_jefe <= 95 ~ '95',
                           )) %>% 
  group_by(edad) %>% 
  summarise(promedio = weighted.mean(ing_cor, w=factor_hog)) %>% 
  ggplot(aes(x=edad, y=promedio))+geom_bar(stat = "identity", fill = "#FF6666") + labs(title = "", x="edad",y='Promedio del ingreso')

```


```{r}
hog %>% dplyr::filter(clase_hog == 1) %>% 
  mutate(edad = case_when(edad_jefe >= 12 & edad_jefe <=15  ~ '12-15',
                          edad_jefe > 15 & edad_jefe <= 20 ~ '15-20',
                          edad_jefe > 20 & edad_jefe <= 25 ~ '20-25',
                           edad_jefe > 25 & edad_jefe <= 30 ~ '25-30',
                           edad_jefe > 30 & edad_jefe <= 35 ~ '30-35',
                           edad_jefe > 35 & edad_jefe <= 40 ~ '35-40',
                           edad_jefe > 40 & edad_jefe <= 45 ~ '40-45',
                           edad_jefe > 45 & edad_jefe <= 50 ~ '45-50',
                           edad_jefe > 50 & edad_jefe <= 55 ~ '50-55',
                           edad_jefe > 55 & edad_jefe <= 60 ~ '55-60',
                           edad_jefe > 60 & edad_jefe <= 65 ~ '60-65',
                           edad_jefe > 65 & edad_jefe <= 70 ~ '65-70',
                           edad_jefe > 70 & edad_jefe <= 75 ~ '70-75',
                           edad_jefe > 75 & edad_jefe <= 80 ~ '75-80',
                           edad_jefe > 80 & edad_jefe <= 85 ~ '80-85',
                           edad_jefe > 85 & edad_jefe <= 90 ~ '85-90',
                           edad_jefe > 90 & edad_jefe <= 95 ~ '90-95',
                           edad_jefe > 95 & edad_jefe <= 100 ~ '95-100'
                           )) %>% 
  group_by(edad) %>% 
  summarise(promedio = weighted.mean(ing_cor, w=factor_hog)) %>% 
    kable(booktabs = T, format = "latex", caption = "Ingreso promedio por grupo de edad") %>% kable_styling(position = "center", latex_options = "HOLD_position")
```


## *Interprete sus resultados a la luz de la HIP y comparados con los resultados para las variables agregadas.*






# *Ejercicio 5*

# *Utilice el método del árbol binomial para, primero, explicar el precio P=80 de un activo y, después, valuar un ``call'' sobre dicho activo, con precio de ejercicio K=P-N donde N es el número de su equipo, (Grupo 1, use N=1, Grupo 2, use N=2, etc) asumiendo una tasa de interés de 5 por ciento:*

Denotemos el precio del activo como $S_{0}=80$

```{r}

binomopt(s= 80, k=75, tt=0.25, r= 0.05, v= 0.30, d=0, nstep = 1)
bin <- binomplot(s= 80, k=75, tt=0.25, r= 0.05, v= 0.30, d=0, nstep = 1, plotarrows = T, plotvalues = T)


```


```{r}


bin <- binomplot(s= 80, k=75, tt=0.25, r= 0.05, v= 0.30, d=0, nstep = 4, plotarrows = T, plotvalues = T)
```


